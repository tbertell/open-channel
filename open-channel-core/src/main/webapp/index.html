<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>OpenChannel UI</title>

<link rel="stylesheet" href="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.css" />
<script src="http://code.jquery.com/jquery-1.8.2.min.js"></script>
<script src="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.js"></script>

</head>
<body>

	<!-- Container page -->
	<div data-role="page" id="home">
		<div data-role="header" id="hdrChannelTypes" data-nobackbtn="true">
			<h1>Channel type list</h1>
		</div>

		<div data-role="content" id="contentChannelTypes">
			<ul data-role="listview" data-inset="true" id="channelDetails"></ul>
		</div>

		<div data-role="footer" id="ftrChannelTypes"></div>
	

	<!-- StockQuoteChannel -->
	<div data-role="header" id="hdrStockQuoteChannel" data-nobackbtn="true">
		<h1>StockQuoteChannel</h1>
		<a id="buttonHdrShowChannelTypes" data-icon="arrow-l"
			class="ui-btn-left" href="" data-role="button" data-inline="true">Back</a>
	</div>

	<div data-role="content" id="contentStockQuoteChannel"></div>

	<div data-role="footer" id="ftrStockQuoteChannel">
		<a id="buttonUpdate" data-icon="arrow-r" class="ui-btn-right" href=""
			data-role="button" data-inline="true">Update</a>
	</div>

	<!-- TimerLogChannel -->
	<div data-role="header" id="hdrTimerLogChannel" data-nobackbtn="true">
		<h1>TimerLogChannel</h1>
		<a id="buttonHdrShowChannelTypes" data-icon="arrow-l"
			class="ui-btn-left" href="" data-role="button" data-inline="true">Back</a>
	</div>

	<div data-role="content" id="contentTimerLogChannel"></div>

	<div data-role="footer" id="ftrTimerLogChannel">
		<a id="buttonUpdate" data-icon="arrow-r" class="ui-btn-right" href=""
			data-role="button" data-inline="true">Update</a>
	</div>

	<!-- Progress -->
	<div data-role="header" id="hdrProgress" data-nobackbtn="true">
		<h1>Processing...</h1>
	</div>
	<div data-role="content" id="contentProgress">
		<div align="CENTER">
			<h4>Please wait.</h4>
		</div>
		<div align="CENTER">
			<img id="spin" src="img/wait.gif" />
		</div>
	</div>
	<div data-role="footer" id="ftrProgress"></div>
	<script>
    
	var rootURL = 'http://localhost:8080/channels/';
	
	$(document).ready(function () {  
	  showProgress();  
	  doGetCall(createList, rootURL);
	  showChannelTypes();
	});
	   
	function createList(xml) {  
		
		var channelDetailsVar = $('#channelDetails'); 
		
		$(xml).find("channel").each(function() {
			var id = $(this).find("id").text();
			var description = $(this).find("description").text();
			var link = $(this).find("link").attr("href");
			
			var liId = "channel_d_li_" +id;
			var descId = "channel_p_" +id;
			var editId = "channel_d_" +id;
			
			$('<li id="' + liId + '"><a href="#" id="' +  editId +'"><h3>'+ id + '</h3><p>' + description + 
					'</p>' + '</a></li>').prependTo(channelDetailsVar);
			$('#' +liId).click(function() {
				 console.log('clicked: ' +liId); 
			 });
		});
		 
		$(channelDetailsVar).listview("refresh");
	}  


	
	function doGetCall(handler, restUri) {
	    $.ajax({
	        type: 'GET',
	        url: restUri,
	        dataType: "xml",
	        headers: {"Authorization": make_base_auth('test', 'test1')},
	        error: function(jqXHR, textStatus, errorThrown) {
	          console.log('AJAX call failed: '+textStatus+' '+errorThrown); 
	        },
	        success: handler
	    });
	    return false;
	}
	
	
	function make_base_auth(user, password) {
	  var tok = user + ':' + password;
	  var hash = btoa(tok);
	  return "Basic " + hash;
	}
	
	
	var hdrChannelTypesVar = $('#hdrChannelTypes');
	var contentChannelTypesVar = $('#contentChannelTypes');
	var ftrChannelTypesVar = $('#ftrChannelTypes');
	
	var hdrStockQuoteChannelVar = $('#hdrStockQuoteChannel');
	var contentStockQuoteChannelVar = $('#contentStockQuoteChannel');
	var ftrStockQuoteChannelVar = $('#ftrStockQuoteChannel');
	
	var hdrTimerLogChannelVar = $('#hdrTimerLogChannel');
	var contentTimerLogChannelVar = $('#contentTimerLogChannel');
	var ftrTimerLogChannelVar = $('#ftrTimerLogChannel');
	
	var hdrProgressVar = $('#hdrProgress');
	var contentProgressVar = $('#contentProgress');
	var ftrProgressVar = $('#ftrProgress');
	
	function hideChannelTypes() {
		hdrChannelTypesVar.hide();
		contentChannelTypesVar.hide();
		ftrChannelTypesVar.hide();      
	}
	
	function showChannelTypes() {
		hideStockQuoteChannel();
		hideTimerLogChannel();
	  hideProgress();
	  hdrChannelTypesVar.show();
		contentChannelTypesVar.show();
		ftrChannelTypesVar.show();
	}
	
	function hideStockQuoteChannel() {
		hdrStockQuoteChannelVar.hide();
		contentStockQuoteChannelVar.hide();
		ftrStockQuoteChannelVar.hide();      
	}
	
	function showStockQuoteChannel() {
		hideChannelTypes();
		hideTimerLogChannel();
	  hideProgress();
	  hdrStockQuoteChannelVar.show();
		contentStockQuoteChannelVar.show();
		ftrStockQuoteChannelVar.show();     
	}
	
	function hideTimerLogChannel() {
		hdrTimerLogChannelVar.hide();
		contentTimerLogChannelVar.hide();
		ftrTimerLogChannelVar.hide();      
	}
	
	function showTimerLogChannel() {
		hideChannelTypes();
		showStockQuoteChannel();
	  hideProgress();
		hdrTimerLogChannelVar.show();
		contentTimerLogChannelVar.show();
		ftrTimerLogChannelVar.show(); 
	}
	 
	function showProgress() {
		hideChannelTypes();
	  	hideStockQuoteChannel();
	  	hideTimerLogChannel();
	  	hdrProgressVar.show();
	  	contentProgressVar.show();
	  	ftrProgressVar.show();
	}
	
	function hideProgress() {
		hdrProgressVar.hide();
		contentProgressVar.hide();
		ftrProgressVar.hide();
	}   
    </script>
    </div>
</body>
</html>